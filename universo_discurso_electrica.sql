--Universidad Laica Eloy Alfaro de Manabí
--Mendoza Parraga Andres Gonzalo
--Materia: Gestión de base de datos
--Docente y colaborador: Ing. Robert Wilfrido Moreira Centeno, Mg

/*==============================================================*/
/* Table: CLIENTE_FACTURA                                       */
/*==============================================================*/
create table CLIENTE_FACTURA (
   ID_CLIENTE           NUMERIC(8)           not null,
   NOMBRE_CLIENTE       CHAR(256)            null,
   APELLIDO_CLIENTE     CHAR(256)            null,
   PROVINCIA_CLIENTE    CHAR(256)            null,
   CANTON_CLIENTE       CHAR(256)            null,
   PARROQUIA_CLIENTE    CHAR(256)            null,
   constraint PK_CLIENTE_FACTURA primary key (ID_CLIENTE)
);

/*==============================================================*/
/* Table: FACTURA                                               */
/*==============================================================*/
create table FACTURA (
   ID_FACTURA           NUMERIC(8)           not null,
   ID_TARIFA            NUMERIC(8)           null,
   ID_CLIENTE           NUMERIC(8)           null,
   ID_LECTURA_MEDIDOR   NUMERIC(8)           null,
   ID_CLIENTE_FACTURA   NUMERIC(8)           null,
   ID_LECTURA_MEDIDOR_FACTURA NUMERIC(8)           null,
   ID_TARIFA_FACTURA    NUMERIC(8)           null,
   FECHA_AUTORIZACION   DATE                 null,
   NUMERO_AUTORIZACION  NUMERIC(8)           null,
   constraint PK_FACTURA primary key (ID_FACTURA)
);

/*==============================================================*/
/* Table: LECTURA_MEDIDOR                                       */
/*==============================================================*/
create table LECTURA_MEDIDOR (
   ID_LECTURA_MEDIDOR   NUMERIC(8)           not null,
   ID_MEDIDOR           NUMERIC(8)           null,
   LECTURA_DESCRIPCION_MEDIDOR CHAR(256)            null,
   LECTURA_ACTUAL       NUMERIC              null,
   LECTURA_ANTERIOR     NUMERIC              null,
   LECTURA_CONSUMO      NUMERIC              null,
   constraint PK_LECTURA_MEDIDOR primary key (ID_LECTURA_MEDIDOR)
);

/*==============================================================*/
/* Table: MEDIDOR                                               */
/*==============================================================*/
create table MEDIDOR (
   ID_MEDIDOR           NUMERIC(8)           not null,
   ID_CLIENTE           NUMERIC(8)           null,
   FECHA_DESDE          DATE                 null,
   FECHA_HASTA          DATE                 null,
   DIAS_FACTURADOS      NUMERIC              null,
   DIRECCION_MEDIDOR    CHAR(256)            null,
   ID_CLIENTE_MEDIDOR   NUMERIC(8)           null,
   ID_LECTURA           NUMERIC(8)           null,
   constraint PK_MEDIDOR primary key (ID_MEDIDOR)
);

/*==============================================================*/
/* Table: TARIFA                                                */
/*==============================================================*/
create table TARIFA (
   ID_TARIFA            NUMERIC(8)           not null,
   NOMBRE_TARIFA        CHAR(256)            null,
   constraint PK_TARIFA primary key (ID_TARIFA)
);

alter table FACTURA
   add constraint FK_FACTURA_RELATIONS_TARIFA foreign key (ID_TARIFA)
      references TARIFA (ID_TARIFA)
      on delete restrict on update restrict;

alter table FACTURA
   add constraint FK_FACTURA_RELATIONS_CLIENTE_ foreign key (ID_CLIENTE)
      references CLIENTE_FACTURA (ID_CLIENTE)
      on delete restrict on update restrict;

alter table FACTURA
   add constraint FK_FACTURA_RELATIONS_LECTURA_ foreign key (ID_LECTURA_MEDIDOR)
      references LECTURA_MEDIDOR (ID_LECTURA_MEDIDOR)
      on delete restrict on update restrict;

alter table LECTURA_MEDIDOR
   add constraint FK_LECTURA__RELATIONS_MEDIDOR foreign key (ID_MEDIDOR)
      references MEDIDOR (ID_MEDIDOR)
      on delete restrict on update restrict;

alter table MEDIDOR
   add constraint FK_MEDIDOR_RELATIONS_CLIENTE_ foreign key (ID_CLIENTE)
      references CLIENTE_FACTURA (ID_CLIENTE)
      on delete restrict on update restrict;
	  
insert into CLIENTE_FACTURA values (00000001, 'JUAN CARLOS', 'CEDEÑO PILOSO', 'MANABI', 'ROCAFUERTE', 'ROCAFUERTE');
insert into CLIENTE_FACTURA values (00000002, 'JOSUE RICARDO', 'CEDEÑO PILOSO', 'MANABI', 'ROCAFUERTE', 'ROCAFUERTE');
insert into CLIENTE_FACTURA values (00000003,'ANDREINA CRISTINA', 'MENDOZA RIVERA', 'MANABI', 'ROCAFUERTE', 'ROCAFUERTE');

insert into TARIFA values (00000001, 'RESIDENCIAL');
insert into TARIFA values (00000002,'COMERCIAL');
insert into TARIFA values (00000003, 'INDUSTRIAL');

insert into MEDIDOR values (12345678, 00000002, '9/10/2020', '9/11/2020', 31, 'CALLE PEDRO CARBO', 00000002, 12340000);
insert into MEDIDOR values (86745123, 00000002, '9/10/2020', '9/11/2020', 31, 'CALLE 30 DE SEPTIEMBRE', 00000002, 12350000);
insert into MEDIDOR values (12341234, 00000001, '9/10/2020', '9/11/2020', 31, 'CALLE INDEPENDECIA', 00000001, 34340000);
insert into MEDIDOR values (56781234, 00000003, '9/10/2020', '9/11/2020', 31, 'AV. 6 DE DICIEMBRE', 00000003, 44440000);

insert into LECTURA_MEDIDOR values (12340000, 12345678, 'ENERGIA MEDIDA', 11125, 10794, 331);
insert into LECTURA_MEDIDOR values (12350000, 86745123, 'ENERGIA MEDIDA', 10903, 10235, 668);
insert into LECTURA_MEDIDOR values (34340000, 12341234, 'ENERGIA MEDIDA', 12045, 11345, 700);
insert into LECTURA_MEDIDOR values (44440000, 56781234, 'ENERGIA MEDIDA', 13078, 10756, 2322);

insert into FACTURA values (11112222, 00000001, 00000002, 12340000, 00000002, 12340000, 00000001, '20/10/2020', 12561256);
insert into FACTURA values (11113333, 00000002, 00000002, 12350000, 00000002, 12350000, 00000002, '27/10/2020', 11111256);
insert into FACTURA values (11114444, 00000001, 00000001, 34340000, 00000001, 34340000, 00000001, '22/10/2020', 22221256);
insert into FACTURA values (11115555, 00000001, 00000003, 44440000, 00000003, 44440000, 00000001, '23/10/2020', 33331256);

/*
Consultas

select
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDOS,
	MEDIDOR.ID_MEDIDOR AS CODIGO_MEDIDOR,
	MEDIDOR.FECHA_DESDE,
	MEDIDOR.FECHA_HASTA,
	MEDIDOR.DIAS_FACTURADOS
from CLIENTE_FACTURA
INNER JOIN PUBLIC.MEDIDOR ON MEDIDOR.ID_CLIENTE_MEDIDOR = CLIENTE_FACTURA.ID_CLIENTE

select
	FACTURA.ID_FACTURA AS NUMERO_FACTURA,
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO_CLIENTE,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDO,
	CLIENTE_FACTURA.PROVINCIA_CLIENTE AS PROVINCIA,
	CLIENTE_FACTURA.CANTON_CLIENTE AS CANTON,
	CLIENTE_FACTURA.PARROQUIA_CLIENTE AS PARROQUIA,
	FACTURA.FECHA_AUTORIZACION AS FECHA_AUTORIZACION,
	FACTURA.NUMERO_AUTORIZACION AS NUMERO_AUTORIZACION,
	LECTURA_MEDIDOR.LECTURA_DESCRIPCION_MEDIDOR,
	LECTURA_MEDIDOR.LECTURA_ACTUAL,
	LECTURA_MEDIDOR.LECTURA_ANTERIOR,
	LECTURA_MEDIDOR.LECTURA_CONSUMO,
	MEDIDOR.ID_MEDIDOR AS CODIGO_MEDIDOR,
	MEDIDOR.FECHA_DESDE,
	MEDIDOR.FECHA_HASTA,
	MEDIDOR.DIAS_FACTURADOS
from FACTURA
INNER JOIN PUBLIC.CLIENTE_FACTURA ON CLIENTE_FACTURA.ID_CLIENTE = FACTURA.ID_CLIENTE_FACTURA
INNER JOIN PUBLIC.LECTURA_MEDIDOR ON LECTURA_MEDIDOR.ID_LECTURA_MEDIDOR = FACTURA.ID_LECTURA_MEDIDOR_FACTURA
INNER JOIN PUBLIC.MEDIDOR ON MEDIDOR.ID_CLIENTE_MEDIDOR = CLIENTE_FACTURA.ID_CLIENTE

select 
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO_CLIENTE,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDO,
	CLIENTE_FACTURA.PROVINCIA_CLIENTE AS PROVINCIA,
	CLIENTE_FACTURA.CANTON_CLIENTE AS CANTON,
	CLIENTE_FACTURA.PARROQUIA_CLIENTE AS PARROQUIA,
	MEDIDOR.ID_MEDIDOR AS CODIGO_MEDIDOR,
	MEDIDOR.DIRECCION_MEDIDOR
from CLIENTE_FACTURA
INNER JOIN PUBLIC.MEDIDOR ON MEDIDOR.ID_CLIENTE_MEDIDOR = CLIENTE_FACTURA.ID_CLIENTE
WHERE CLIENTE_FACTURA.APELLIDO_CLIENTE = 'CEDEÑO PILOSO'

select 
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO_CLIENTE,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDO,
	CLIENTE_FACTURA.PROVINCIA_CLIENTE AS PROVINCIA,
	CLIENTE_FACTURA.CANTON_CLIENTE AS CANTON,
	CLIENTE_FACTURA.PARROQUIA_CLIENTE AS PARROQUIA,
	TARIFA.NOMBRE_TARIFA
from FACTURA
INNER JOIN PUBLIC.CLIENTE_FACTURA ON CLIENTE_FACTURA.ID_CLIENTE = FACTURA.ID_CLIENTE_FACTURA
INNER JOIN PUBLIC.TARIFA ON TARIFA.ID_TARIFA = FACTURA.ID_TARIFA_FACTURA
WHERE FACTURA.ID_TARIFA_FACTURA = 00000002

select
	FACTURA.ID_FACTURA AS NUMERO_FACTURA,
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO_CLIENTE,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDO,
	CLIENTE_FACTURA.PROVINCIA_CLIENTE AS PROVINCIA,
	CLIENTE_FACTURA.CANTON_CLIENTE AS CANTON,
	CLIENTE_FACTURA.PARROQUIA_CLIENTE AS PARROQUIA,
	FACTURA.FECHA_AUTORIZACION AS FECHA_AUTORIZACION,
	FACTURA.NUMERO_AUTORIZACION AS NUMERO_AUTORIZACION,
	LECTURA_MEDIDOR.LECTURA_DESCRIPCION_MEDIDOR,
	LECTURA_MEDIDOR.LECTURA_ACTUAL,
	LECTURA_MEDIDOR.LECTURA_ANTERIOR,
	LECTURA_MEDIDOR.LECTURA_CONSUMO
from FACTURA
INNER JOIN PUBLIC.CLIENTE_FACTURA ON CLIENTE_FACTURA.ID_CLIENTE = FACTURA.ID_CLIENTE_FACTURA
INNER JOIN PUBLIC.LECTURA_MEDIDOR ON LECTURA_MEDIDOR.ID_LECTURA_MEDIDOR = FACTURA.ID_LECTURA_MEDIDOR_FACTURA
WHERE LECTURA_MEDIDOR.LECTURA_CONSUMO > 1000

select
	FACTURA.ID_FACTURA AS NUMERO_FACTURA,
	CLIENTE_FACTURA.ID_CLIENTE AS CODIGO_CLIENTE,
	CLIENTE_FACTURA.NOMBRE_CLIENTE AS NOMBRES,
	CLIENTE_FACTURA.APELLIDO_CLIENTE AS APELLIDO,
	CLIENTE_FACTURA.PROVINCIA_CLIENTE AS PROVINCIA,
	CLIENTE_FACTURA.CANTON_CLIENTE AS CANTON,
	CLIENTE_FACTURA.PARROQUIA_CLIENTE AS PARROQUIA,
	FACTURA.FECHA_AUTORIZACION AS FECHA_AUTORIZACION,
	FACTURA.NUMERO_AUTORIZACION AS NUMERO_AUTORIZACION,
	LECTURA_MEDIDOR.LECTURA_DESCRIPCION_MEDIDOR,
	LECTURA_MEDIDOR.LECTURA_ACTUAL,
	LECTURA_MEDIDOR.LECTURA_ANTERIOR,
	LECTURA_MEDIDOR.LECTURA_CONSUMO
from FACTURA
INNER JOIN PUBLIC.CLIENTE_FACTURA ON CLIENTE_FACTURA.ID_CLIENTE = FACTURA.ID_CLIENTE_FACTURA
INNER JOIN PUBLIC.LECTURA_MEDIDOR ON LECTURA_MEDIDOR.ID_LECTURA_MEDIDOR = FACTURA.ID_LECTURA_MEDIDOR_FACTURA
WHERE LECTURA_MEDIDOR.LECTURA_CONSUMO < 699
*/ 


